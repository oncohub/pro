angular.module("app",["ionic","jett.ionic.filter.bar","ui.router","ng-sortable","barcode","angular-barcode","ion-smooth-scroll"]).controller("HomeCtrl",["$scope","$timeout","$state","$window","sharedService","$ionicScrollDelegate","$ionicFilterBar","$ionicSideMenuDelegate","$ionicLoading","$ionicPopup","$location",function(e,t,a,n,r,o,i,l,s,c,u){e.shareData=r,o.$getByHandle("coverScroll").freezeScroll(!0),e.sortableConf={animation:400,delay:100,ghostClass:"sortable-ghost",dragClass:"sortable-drag",chosenClass:"sortable-chosen",handle:".grab-handle",forceFallback:!0,onStart:function(t){e.sortableDragFlg=!0},onEnd:function(t){e.sortableDragFlg=!1},onSort:function(t){e.sortingFlg=!0},store:{set:function(t){e.sortingResult=t.toArray()}}};var f=[3,7,8,9,10,15,16,19,20,30],d=proctcae.filter(function(e){return f.some(function(t){return t===e.id})}),h=proctcae.filter(function(e){return!f.some(function(t){return t===e.id})});e.shareData.elements=d,e.shareData.elements2=h,e.moveItemOneToTwo=function(a){var n=proctcae.filter(function(e){return e.id===a})[0];e.shareData.elements=e.shareData.elements.filter(function(e){return e.id!==a}),e.shareData.elements2.unshift(n),t(function(){o.$getByHandle("menuScroll").scrollTop(!0)})},e.moveItemTwoToOne=function(a){var n=proctcae.filter(function(e){return e.id===a})[0];e.shareData.elements2=e.shareData.elements2.filter(function(e){return e.id!==a}),e.shareData.elements.unshift(n),t(function(){o.$getByHandle("mainScroll").scrollTop(!0),o.$getByHandle("menuScroll").scrollTop(!0)})};var g,m=document.getElementById("list1"),v=document.getElementById("list2"),p=[];Sortable.create(m,{group:"todo",animation:150,onChange:function(t){p=e.shareData.elements2.filter(function(e){return e.id!=g}),console.log("list2 > list1 change",p)}}),Sortable.create(v,{group:"todo",animation:150,onStart:function(e){e.preventDefault(),e.stopPropagation(),g=Number(e.item.getAttribute("id"))},onRemove:function(a){a.preventDefault(),a.stopPropagation(),t(function(){e.searchText&&(e.searchText=void 0)})},onChange:function(t){t.preventDefault(),t.stopPropagation(),e.searchText&&(e.searchText=void 0)}}),e.changed=function(t){""==t&&(e.searchText=void 0)},e.start=function(e){return!1},e.setGrade=function(e,t,a,n){a.selected=n,console.log(e),u.hash(e.id),o.anchorScroll(!0),0===e.items[0].selected&&e.items.forEach(function(e,t){t>0&&(e.selected=void 0)})},e.height=function(e){return document.getElementById(e).offsetHeight},e.toggleDrawer=function(){e.toggleStatus=!e.toggleStatus},e.shareData.element=function(e){return e.items.some(function(e){return e.selected||0===e.selected})};var D=angular.element(n);D.bind("resize",function(){e.windowheight=document.getElementById("ref").offsetHeight,console.log("Resized your browser",e.windowheight)}),e.initialize=function(e){if(0===e[0].selected)try{e[1].selected=void 0,e[2].selected=void 0}catch(e){}},e.shareData.flags||(e.shareData.flags={}),e.shareData.secondaryOn=!0,e.$on("$ionicView.beforeLeave",function(e){}),e.$on("$ionicView.beforeEnter",function(t){e.shareData.flagNum=Object.keys(e.shareData.flags).length}),e.$on("$ionicView.afterEnter",function(){}),e.freezeScroll=function(){o.$getByHandle("mainScroll").getScrollView().options.scrollingY=!1},e.enableScroll=function(){o.$getByHandle("mainScroll").getScrollView().options.scrollingY=!0},e.shareData.local={en:{all:"All",flagged:"Flagged",back:"Back",search:"Search",cancel:"Cancel",def:"Definition",nav:"Navigational Note"},ja:{all:"すべて",flagged:"フラグ付き",back:"戻る",search:"検索",cancel:"キャンセル",def:"定義",nav:"検索上の注意"}},e.socTitle={en:e.shareData.local.en.all,ja:e.shareData.local.ja.all},e.shareData.lang="ja",e.shareData.langJa=!0,e.showFilterBar=function(){l.isOpen()&&l.toggleLeft(),filterBarInstance=i.show({cancel:function(){e.shareData.search=""}})},e.shareData.encode=function(e,t){try{for(var a=t?String(e[t]):String(e),n=String(a).length,r=[];n--;){var o=a[n].charCodeAt();'"'===a[n]?r[n]="&quot;":"&"===a[n]?r[n]="&amp;":r[n]=62===o?"&gt;":60===o?"&lt;":a[n]}return r.join("")}catch(e){console.log(e)}},e.scrollTop=function(){o.scrollTop(!1)},e.toggleLeft=function(){o.scrollTop(!1),e.shareData.search="",l.toggleLeft(),e.shareData.flagNum=Object.keys(e.shareData.flags).length},e.flagging=function(t,a){console.log(t),a.preventDefault(),a.stopPropagation(),e.shareData.flags[t]?delete e.shareData.flags[t]:e.shareData.flags[t]=!0,e.shareData.putDb("flags",e.shareData.flags),e.shareData.flagNum=Object.keys(e.shareData.flags).length}}]).controller("DetailCtrl",["$scope","sharedService",function(e,t){e.shareData=t}]).controller("SearchCtrl",["$scope","sharedService",function(e,t){e.shareData=t}]).controller("PsCtrl",["$scope","sharedService",function(e,t){function a(e,t){try{return e[t].some(function(t){return t===e.selected})}catch(e){return!1}}function n(){o(),e.ctcaes=e.shareData.elements.map(function(e){var t=[!1,!1],n=[void 0,void 0,void 0],r=9;e.items.forEach(function(e){"頻度: "===e.title&&(n[0]=e.selected,a(e,"yellow")?t[0]=!0:t[0]=!1,a(e,"red")?t[1]=!0:t[1]=!1),"程度: "===e.title&&(n[1]=e.selected,a(e,"yellow")?t[0]=!0:t[0]=!1,a(e,"red")?t[1]=!0:t[1]=!1),"生活の妨げ: "===e.title&&(n[2]=e.selected,a(e,"yellow")?t[0]=!0:t[0]=!1,a(e,"red")?t[1]=!0:t[1]=!1),"有無: "===e.title&&(0===e.selected?r=1:1===e.selected&&(r=0),a(e,"yellow")?t[0]=!0:t[0]=!1,a(e,"red")?t[1]=!0:t[1]=!1)}),e.severity=t[0]?"★":t[1]?"★★":null,console.log(e);var o={},i=ctcae.filter(function(t){return String(t.meddra)===String(e.meddra)})[0];if(9===r)try{var l=proToCtcae.filter(function(e){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]})[0][3];o.meddra=e.meddra,e.selected||(e.selected=l),o.severity=e.severity,o.selected=l,o.ja=i.termja,o.en=e.ctcaev5,o.ctcae=i}catch(t){o.meddra=e.meddra,e.selected||(e.selected=void 0),o.severity=e.severity,o.selected=void 0,o.ja=i.termja,o.en=e.ctcaev5,o.ctcae=i}else o.meddra=e.meddra,e.selected||(e.selected=r),o.selected=r,o.severity=e.severity,o.ja=i.termja,o.en=e.ctcaev5,o.ctcae=i;return o});var t="";e.ctcaes.forEach(function(e){t=t+"\n"+r(e.selected)+"  "+e.ja+(void 0!==e.selected?": Grade "+e.selected:": undefined")}),e.shareData.aeList="|||||　PRO-CTCAE |||||\n\n"+e.shareData.aeList+"\n|||||　CTCAE　|||||\nGrade 自動変換値 (→ 入力値)\n"+t}function r(e){var t="□□□□□";switch(e){case 1:t="■□□□□";break;case 2:t="■■□□□";break;case 3:t="■■■□□";break;case 4:t="■■■■□";break;case 5:t="■■■■■";break;default:t="□□□□□"}return t}function o(){e.shareData.aeList=e.shareData.elements.map(function(e){return e.id+": "+e.term+"\n"+e.items.map(function(t,n,r){if(!(n>0)||e.items[0].selected>0){var o=[!1,!1];return"頻度: "===t.title&&(a(t,"yellow")?o[0]=!0:o[0]=!1,a(t,"red")?o[1]=!0:o[1]=!1),"程度: "===t.title&&(a(t,"yellow")?o[0]=!0:o[0]=!1,a(t,"red")?o[1]=!0:o[1]=!1),"生活の妨げ: "===t.title&&(a(t,"yellow")?o[0]=!0:o[0]=!1,a(t,"red")?o[1]=!0:o[1]=!1),"有無: "===t.title&&(0===t.selected?yn=1:1===t.selected&&(yn=0),a(t,"yellow")?o[0]=!0:o[0]=!1,a(t,"red")?o[1]=!0:o[1]=!1),(o[0]?"★　":o[1]?"★★":"　　")+t.title+t.ans.filter(function(e,a){return t.selected===a})[0]+"\n"}})}).join("\n").replace(/\,/g,"")}function i(e){for(var t="",a=0,n=10240;a<e.byteLength/n;++a)t+=String.fromCharCode.apply(null,new Uint8Array(e.slice(a*n,a*n+n)));return t+=String.fromCharCode.apply(null,new Uint8Array(e.slice(a*n))),t}function l(e){var t=XLSX.utils.sheet_to_json(e.Sheets[e.SheetNames[0]],{raw:!0,header:"A"});return t.length>0?t:void 0}e.shareData=t,e.$on("$ionicView.beforeEnter",function(e){n()}),e.gradeChange=function(t,a){t.selectedNew===a?t.selectedNew=void 0:t.selectedNew=a,console.log(t.selectedNew,a);var n="";o(),e.ctcaes.forEach(function(e){n=n+"\n"+r(e.selectedNew?e.selectedNew:e.selected)+"  "+e.ja+(void 0!==e.selected?": Grade "+e.selected+(void 0!==e.selectedNew?" → "+e.selectedNew:""):": undefined"+(void 0!==e.selectedNew?" → "+e.selectedNew:""))}),e.shareData.aeList="|||||　PRO-CTCAE |||||\n\n"+e.shareData.aeList+"\n|||||　CTCAE　|||||\nGrade 自動変換値 (→ 入力値値)\n"+n},e.shareData.fileNameChanged=function(t){var a=t.target.files,n=a[0],r=new FileReader;r.onload=function(t){var a,n=t.target.result,r=i(n);a=XLSX.read(btoa(r),{type:"base64",cellDates:!0});var o="";o=l(a),console.log(o),e.shareData.itemList=o,e.shareData.unique="__rowNum__",e.shareData.term="A",e.shareData.group="B";e.shareData.groupList=e.shareData.itemList.map(function(e){return e.B}).filter(function(e,t,a){return a.map(function(e){return e}).indexOf(e)===t}).sort();var s=[];for(var c in e.shareData.itemList.sort(function(e,t){return e.B.localeCompare(t.B)||e.A.localeCompare(t.A)}),e.shareData.groupList.forEach(function(t){var a=e.shareData.itemList.map(function(e){return e.B}).indexOf(t);s.unshift(a)}),s)e.shareData.itemList.splice(s[c],0,{A:e.shareData.itemList[s[c]].B,B:!1})},r.readAsArrayBuffer(n)},e.options={width:2,height:40,quite:1,displayValue:!0,font:"monospace",textAlign:"center",fontSize:12,backgroundColor:"",lineColor:"#000"},e.options2={format:"CODE128",lineColor:"#000000",width:2,height:40,displayValue:!0,fontOptions:"",font:"monospace",textAlign:"center",textPosition:"bottom",textMargin:1,fontSize:12,background:"#ffffff",margin:0,marginTop:void 0,marginBottom:void 0,marginLeft:void 0,marginRight:void 0,valid:function(e){}},e.anscheck=function(e){try{return text=String(e.id),e.items.forEach(function(e){text=text+"q"+e.q+"s"+(void 0===e.selected?"x":e.selected)}),text}catch(e){}}}]).controller("InfoCtrl",["$scope","sharedService","$ionicPopup",function(e,t,a){e.shareData=t,e.$on("$ionicView.enter",function(e){}),e.shareData.removeFlags=function(){var t=a.confirm({title:"Remove Flags",template:"Are you sure you want to remove all flags?"});t.then(function(t){if(t){var a={};e.shareData.flags=a,e.shareData.putDb("flags",a)}else console.log("You are not sure")})},e.shareData.unregister=function(){var e=a.confirm({title:"Unregister / Remove Cashe",template:"Are you sure you want to unregister Service Worker and remove Cashe?"});e.then(function(e){e?swUnregister():console.log("You are not sure")})}}]).config(["$stateProvider","$urlRouterProvider","$ionicFilterBarConfigProvider",function(e,t,a){e.state("tabs",{url:"/tabs",abstract:!0,templateUrl:"tabs.html"}).state("tabs.home",{url:"/home",views:{"tabs-home":{templateUrl:"templates/home.min.html"}}}).state("tabs.detail",{url:"/detail",views:{"tabs-home":{templateUrl:"templates/detail.min.html"}}}).state("tabs.info",{url:"/info",views:{"tabs-info":{templateUrl:"templates/info.min.html"}}}).state("tabs.privacy",{url:"/privacy",views:{"tabs-info":{templateUrl:"templates/privacy.min.html"}}}).state("tabs.term",{url:"/term",views:{"tabs-info":{templateUrl:"templates/term.min.html"}}}).state("tabs.third",{url:"/third",views:{"tabs-info":{templateUrl:"templates/third.min.html"}}}).state("tabs.about",{url:"/about",views:{"tabs-about":{templateUrl:"templates/about.min.html"}}}).state("tabs.install",{url:"/install",views:{"tabs-info":{templateUrl:"templates/install.min.html"}}}),t.otherwise("/tabs/home"),a.backdrop(!0)}]).factory("sharedService",function(){return{text:"sharedService"}}).filter("highlight",["$sce",function(e){return function(t,a){function n(e){for(var t=e.length,a=[];t--;){var n=e[t].charCodeAt();'"'===e[t]?a[t]="&quot;":"&"===e[t]?a[t]="&amp;":a[t]=62===n?"&gt;":60===n?"&lt;":e[t]}return a.join("")}function r(e){for(var t=e.length,a=[];t--;)["[","\\","^","$",".","|","?","*","+","(",")"].some(function(a){return a===e[t]})?a[t]="\\"+e[t]:a[t]=e[t];return a.join("")}return t&&a&&(t=t.replace(new RegExp("("+r(n(a))+")","gi"),'<span class="highlighted">$1</span>')),e.trustAsHtml(t?t.replace(/\n/g,"<br />"):"")}}]).config(["$ionicConfigProvider",function(e){e.navBar.positionPrimaryButtons("left"),e.tabs.position("bottom"),e.tabs.style("standard"),e.navBar.alignTitle("left"),e.backButton.text(""),e.backButton.previousTitleText("")}]).directive("onChange",function(){return{restrict:"A",link:function(e,t,a){var n=e.$eval(a.onChange);t.on("change",n),t.on("$destroy",function(){t.off()})}}});