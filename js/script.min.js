angular.module("app",["ionic","jett.ionic.filter.bar","ui.router","ng-sortable","barcode","angular-barcode"]).controller("HomeCtrl",["$scope","$timeout","$state","$window","sharedService","$ionicScrollDelegate","$ionicFilterBar","$ionicSideMenuDelegate","$ionicLoading","$ionicPopup",function(e,t,a,n,o,r,l,s,c,u){function f(t){var a=indexedDB.open(w);a.onupgradeneeded=function(e){var t=e.target.result;t.createObjectStore(S,{keyPath:"id"})},a.onsuccess=function(a){var n=a.target.result,o=n.transaction(S,"readonly"),r=o.objectStore(S),i=r.get(t);i.onsuccess=function(a){switch(t){case"flags":try{e.shareData.flags=a.target.result.contents,e.shareData.flagNum=Object.keys(e.shareData.flags).length}catch(e){console.log("error",e)}break;case"regimens":try{e.shareData.itemList=a.target.result.contents}catch(e){console.log("error",e)}}},i.onerror=function(e){console.log("db not exist")}},a.onerror=function(a){e.shareData.putDb(t,e.shareData.flags)}}function g(e){var t=indexedDB.deleteDatabase(e);t.onsuccess=function(e){console.log("db delete success")},t.onerror=function(){console.log("db delete error")}}e.shareData=o;var h=[1,3,5,7],d=proctcae.filter(function(e){return h.some(function(t){return t===e.id})}),m=proctcae.filter(function(e){return!h.some(function(t){return t===e.id})});e.shareData.elements=d,e.shareData.elements2=m;var p,v=document.getElementById("list1"),D=document.getElementById("list2"),b=[];Sortable.create(v,{group:"todo",animation:150,onChange:function(t){b=e.shareData.elements2.filter(function(e){return e.id!=p}),console.log("list2 > list1 change",b)}}),Sortable.create(D,{group:"todo",animation:150,onStart:function(e){e.preventDefault(),e.stopPropagation(),p=Number(e.item.getAttribute("id"))},onRemove:function(a){a.preventDefault(),a.stopPropagation(),t(function(){e.shareData.elements2=angular.copy(b),e.searchText&&(e.searchText=void 0)})},onChange:function(t){t.preventDefault(),t.stopPropagation(),e.searchText&&(e.searchText=void 0)}}),e.changed=function(t){""==t&&(e.searchText=void 0)},e.start=function(e){return!1},e.setGrade=function(e,t){e.selected=t},e.height=function(e){return document.getElementById(e).offsetHeight},e.toggleDrawer=function(){e.toggleStatus=!e.toggleStatus},e.shareData.element=function(e){return e.items.some(function(e){return e.selected||0===e.selected})};var y=angular.element(n);y.bind("resize",function(){e.windowheight=document.getElementById("ref").offsetHeight,console.log("Resized your browser",e.windowheight)}),e.initialize=function(e){if(0===e[0].selected)try{e[1].selected=void 0,e[2].selected=void 0}catch(e){}},e.shareData.flags||(e.shareData.flags={}),e.shareData.secondaryOn=!0,e.$on("$ionicView.beforeLeave",function(e){try{document.getElementById("filterBar").style.display="none"}catch(e){console.log(e)}}),e.$on("$ionicView.beforeEnter",function(t){try{e.shareData.flagNum=Object.keys(e.shareData.flags).length,document.getElementById("filterBar").style.display="inherit"}catch(t){console.log(t)}}),e.$on("$ionicView.afterEnter",function(){}),e.freezeScroll=function(){r.$getByHandle("mainScroll").getScrollView().options.scrollingY=!1},e.enableScroll=function(){r.$getByHandle("mainScroll").getScrollView().options.scrollingY=!0},e.shareData.local={en:{all:"All",flagged:"Flagged",back:"Back",search:"Search",cancel:"Cancel",def:"Definition",nav:"Navigational Note"},ja:{all:"すべて",flagged:"フラグ付き",back:"戻る",search:"検索",cancel:"キャンセル",def:"定義",nav:"検索上の注意"}},e.socTitle={en:e.shareData.local.en.all,ja:e.shareData.local.ja.all},e.shareData.lang="ja",e.shareData.langJa=!0,e.showFilterBar=function(){s.isOpen()&&s.toggleLeft(),filterBarInstance=l.show({cancel:function(){e.shareData.search=""}})},e.shareData.encode=function(e,t){try{for(var a=t?String(e[t]):String(e),n=String(a).length,o=[];n--;){var r=a[n].charCodeAt();'"'===a[n]?o[n]="&quot;":"&"===a[n]?o[n]="&amp;":o[n]=62===r?"&gt;":60===r?"&lt;":a[n]}return o.join("")}catch(e){console.log(e)}},e.scrollTop=function(){r.scrollTop(!1)},e.toggleLeft=function(){r.scrollTop(!1),e.shareData.search="",s.toggleLeft(),e.shareData.flagNum=Object.keys(e.shareData.flags).length},e.flagging=function(t,a){console.log(t),a.preventDefault(),a.stopPropagation(),e.shareData.flags[t]?delete e.shareData.flags[t]:e.shareData.flags[t]=!0,e.shareData.putDb("flags",e.shareData.flags),e.shareData.flagNum=Object.keys(e.shareData.flags).length},e.getFlag=function(){var a=Object.keys(e.shareData.flags);e.shareData.itemList=e.shareData.rawList.filter(function(t){if(!t[group])return!0;for(i in this)if(this[i]===t[e.shareData.unique])return t},a).filter(function(t,a,n){try{return!t[group]&&t[e.shareData.term]===n[a+1][group]||t[group]}catch(e){console.log("no data in a category")}}),e.socTitle={en:'<i class="icon ion-ios-flag red-flag head"></i>'+e.shareData.local.en.flagged,ja:'<i class="icon ion-ios-flag red-flag head"></i>'+e.shareData.local.ja.flagged},s.toggleLeft(),t(function(){r.scrollTop(!1)},300)};var w="ctcaeDB",S="flagStore";e.shareData.putDb=function(e,t){var a=indexedDB.open(w);a.onsuccess=function(a){var n=a.target.result,o=n.transaction(S,"readwrite"),r=o.objectStore(S),i=r.put({id:e,contents:t});i.onsuccess=function(){console.log("put data success")},o.oncomplete=function(){console.log("transaction completed")},n.close()},a.onerror=function(e){console.log("db open error")}},f("flags"),e.shareData.dbremove=function(e){g(e)}}]).controller("DetailCtrl",["$scope","sharedService",function(e,t){e.shareData=t}]).controller("SearchCtrl",["$scope","sharedService",function(e,t){e.shareData=t}]).controller("PsCtrl",["$scope","sharedService",function(e,t){function a(e){for(var t="",a=0,n=10240;a<e.byteLength/n;++a)t+=String.fromCharCode.apply(null,new Uint8Array(e.slice(a*n,a*n+n)));return t+=String.fromCharCode.apply(null,new Uint8Array(e.slice(a*n))),t}function n(e){var t=XLSX.utils.sheet_to_json(e.Sheets[e.SheetNames[0]],{raw:!0,header:"A"});return t.length>0?t:void 0}e.shareData=t,e.$on("$ionicView.enter",function(e){try{document.getElementById("filterBar").style.display="none"}catch(e){console.log(e)}}),e.shareData.fileNameChanged=function(t){var o=t.target.files,r=o[0],i=new FileReader;i.onload=function(t){var o,r=t.target.result,i=a(r);o=XLSX.read(btoa(i),{type:"base64",cellDates:!0});var l="";l=n(o),console.log(l),e.shareData.itemList=l,e.shareData.unique="__rowNum__",e.shareData.term="A",e.shareData.group="B";e.shareData.groupList=e.shareData.itemList.map(function(e){return e.B}).filter(function(e,t,a){return a.map(function(e){return e}).indexOf(e)===t}).sort();var s=[];for(var c in e.shareData.itemList.sort(function(e,t){return e.B.localeCompare(t.B)||e.A.localeCompare(t.A)}),e.shareData.groupList.forEach(function(t){var a=e.shareData.itemList.map(function(e){return e.B}).indexOf(t);s.unshift(a)}),s)e.shareData.itemList.splice(s[c],0,{A:e.shareData.itemList[s[c]].B,B:!1})},i.readAsArrayBuffer(r)},e.options={width:2,height:40,quite:1,displayValue:!0,font:"monospace",textAlign:"center",fontSize:12,backgroundColor:"",lineColor:"#000"},e.options2={format:"CODE128",lineColor:"#000000",width:2,height:40,displayValue:!0,fontOptions:"",font:"monospace",textAlign:"center",textPosition:"bottom",textMargin:1,fontSize:12,background:"#ffffff",margin:0,marginTop:void 0,marginBottom:void 0,marginLeft:void 0,marginRight:void 0,valid:function(e){}},e.anscheck=function(e){return text=String(e.id),e.items.forEach(function(e){text=text+"q"+e.q+"s"+(void 0===e.selected?"x":e.selected)}),text}}]).controller("InfoCtrl",["$scope","sharedService","$ionicPopup",function(e,t,a){e.shareData=t,e.$on("$ionicView.enter",function(e){try{document.getElementById("filterBar").style.display="none"}catch(e){console.log(e)}}),e.shareData.removeFlags=function(){var t=a.confirm({title:"Remove Flags",template:"Are you sure you want to remove all flags?"});t.then(function(t){if(t){var a={};e.shareData.flags=a,e.shareData.putDb("flags",a)}else console.log("You are not sure")})},e.shareData.unregister=function(){var e=a.confirm({title:"Unregister / Remove Cashe",template:"Are you sure you want to unregister Service Worker and remove Cashe?"});e.then(function(e){e?swUnregister():console.log("You are not sure")})}}]).config(["$stateProvider","$urlRouterProvider","$ionicFilterBarConfigProvider",function(e,t,a){e.state("tabs",{url:"/tabs",abstract:!0,templateUrl:"tabs.html"}).state("tabs.home",{url:"/home",views:{"tabs-home":{templateUrl:"templates/home.min.html"}}}).state("tabs.detail",{url:"/detail",views:{"tabs-home":{templateUrl:"templates/detail.min.html"}}}).state("tabs.info",{url:"/info",views:{"tabs-info":{templateUrl:"templates/info.min.html"}}}).state("tabs.privacy",{url:"/privacy",views:{"tabs-info":{templateUrl:"templates/privacy.min.html"}}}).state("tabs.term",{url:"/term",views:{"tabs-info":{templateUrl:"templates/term.min.html"}}}).state("tabs.third",{url:"/third",views:{"tabs-info":{templateUrl:"templates/third.min.html"}}}).state("tabs.about",{url:"/about",views:{"tabs-about":{templateUrl:"templates/about.min.html"}}}).state("tabs.install",{url:"/install",views:{"tabs-info":{templateUrl:"templates/install.min.html"}}}),t.otherwise("/tabs/home"),a.backdrop(!0)}]).factory("sharedService",function(){return{text:"sharedService"}}).filter("highlight",["$sce",function(e){return function(t,a){function n(e){for(var t=e.length,a=[];t--;){var n=e[t].charCodeAt();'"'===e[t]?a[t]="&quot;":"&"===e[t]?a[t]="&amp;":a[t]=62===n?"&gt;":60===n?"&lt;":e[t]}return a.join("")}function o(e){for(var t=e.length,a=[];t--;)["[","\\","^","$",".","|","?","*","+","(",")"].some(function(a){return a===e[t]})?a[t]="\\"+e[t]:a[t]=e[t];return a.join("")}return t&&a&&(t=t.replace(new RegExp("("+o(n(a))+")","gi"),'<span class="highlighted">$1</span>')),e.trustAsHtml(t?t.replace(/\n/g,"<br />"):"")}}]).config(["$ionicConfigProvider",function(e){e.navBar.positionPrimaryButtons("left"),e.tabs.position("bottom"),e.tabs.style("standard"),e.navBar.alignTitle("left"),e.backButton.text(""),e.backButton.previousTitleText("")}]).directive("onChange",function(){return{restrict:"A",link:function(e,t,a){var n=e.$eval(a.onChange);t.on("change",n),t.on("$destroy",function(){t.off()})}}});